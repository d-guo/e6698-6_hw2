<!doctype html>
<html>

<head>
    <title>Ass2</title>
    <meta name="description" content="Our first page">
    <meta name="keywords" content="html tutorial template">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.1/axios.min.js"></script>
</head>

<body>
    <form id="uploadForm">
        <input type="file" id="imageFile" name="imageFile"/>
        <br />
        <label for="customLabels">Custom Labels (comma-separated):</label>
        <input type="text" id="customLabels" />
        <br />
        <input type="submit" value="Submit Image" onclick="postImage()">
    </form>
    <form id="searchForm">
        <label for="customLabels">Search Prompt:</label>
        <input type="text" id="searchPrompt" />
        <br />
        <input type="submit" value="Get Image" onclick="getImages(event)">
    </form>
    <div id="container">

    </div>
</body>

<script>
    const toBase64 = file => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });

    async function postImage() {
        // let image = event.target.files[0];
        let image = document.getElementById('imageFile');
        let labels = document.getElementById('customLabels').value;

        let image_data = await toBase64(image.files[0]);

        const response = axios.put('https://mr3cyfkh1f.execute-api.us-east-1.amazonaws.com/beta/upload/b2-ass2/' + image.files[0].name, image_data, {
            headers: {
                'Access-Control-Allow-Origin': '*',
                'Content-Type': 'text/base64',
                'X-API-Key': 'SOi1mwuT0Q5D7ZiIrMJx7615n2AgsTCZ1oj2ec5c',
                'x-amz-meta-customLabels': labels
            },
        });
        alert('d');
    }

    function getImages(event) {
        event.preventDefault();
        document.getElementById('container').innerHTML = '';
        let user_prompt = document.getElementById('searchPrompt').value;
        axios.get('https://mr3cyfkh1f.execute-api.us-east-1.amazonaws.com/beta/search/', {
            headers: {
                'Access-Control-Allow-Origin': '*',
                'X-API-Key': 'SOi1mwuT0Q5D7ZiIrMJx7615n2AgsTCZ1oj2ec5c',
            },
            params: {
                query: user_prompt
            }
        }).then(
            (res) => {
                let images = res.data;
                images.forEach(
                    (image) => {
                        const img = document.createElement('img');
                        img.src = "data:image/jpeg;base64," + image;
                        document.getElementById('container').appendChild(img);
                    }
                );
                console.log("REACHED HERE")
            }
        );

        alert('d');
    }
</script>

</html>